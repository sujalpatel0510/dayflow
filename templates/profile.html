{% extends "base.html" %}

{% block title %}{{ user.first_name }} {{ user.last_name }} - Profile{% endblock %}

{% block nav_employees %}active{% endblock %}

{% block page_title %}Employee Profile{% endblock %}

{% block extra_css %}
<style>
    /* --- 1. Styles matching add_employee.html --- */
    :root {
        --primary-bg: #f4f6f9;
        --card-bg: #ffffff;
        --text-main: #333;
        --text-muted: #6c757d;
        --border-color: #e9ecef;
        /* Using the same primary color variable you likely have in base.html */
    }

    .form-container {
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Back Button Style */
    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--primary-color);
        text-decoration: none;
        margin-bottom: 20px;
        font-weight: 500;
        transition: color 0.2s;
    }
    .back-button:hover { text-decoration: underline; }

    /* Titles */
    .section-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
    }

    /* --- 2. Layout Grid (Sidebar + Content) --- */
    .profile-layout {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 25px;
        align-items: start;
    }

    /* --- Left Sidebar --- */
    .profile-sidebar {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .profile-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 30px 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.02);
    }

    .profile-avatar {
        width: 120px;
        height: 120px;
        background: #e3f2fd; /* Light blue accent */
        color: var(--primary-color);
        border-radius: 50%;
        font-size: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px auto;
        font-weight: bold;
        text-transform: uppercase;
    }

    .profile-name {
        font-size: 24px;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
    }

    .profile-role {
        color: var(--text-muted);
        font-size: 14px;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .sidebar-info-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #eee;
        font-size: 14px;
    }
    .sidebar-info-row:last-child { border-bottom: none; }
    
    .info-label { color: var(--text-muted); }
    .info-val { color: #333; font-weight: 600; text-align: right; }

    /* --- Right Content Area --- */
    .profile-content {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        overflow: hidden;
        min-height: 600px;
    }

    /* Tabs */
    .profile-tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 1px solid var(--border-color);
        padding: 0 20px;
    }

    .tab-btn {
        padding: 16px 24px;
        border: none;
        background: none;
        font-weight: 600;
        color: var(--text-muted);
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.2s;
        font-size: 14px;
    }

    .tab-btn:hover { color: var(--primary-color); }
    
    .tab-btn.active {
        color: var(--primary-color);
        border-bottom: 3px solid var(--primary-color);
        background: white;
    }

    .tab-content-area {
        padding: 30px;
        display: none;
        animation: fadeIn 0.3s;
    }
    .tab-content-area.active { display: block; }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Form Fields (Read Only) */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }

    .form-group label {
        display: block;
        font-size: 12px;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-bottom: 8px;
        font-weight: 600;
        letter-spacing: 0.5px;
    }

    .read-only-field {
        padding: 12px 15px;
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        font-size: 15px;
        color: #333;
        font-weight: 500;
    }

    /* Salary Table */
    .salary-summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .summary-card {
        background: #fff;
        border: 1px solid #e9ecef;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
    }
    .summary-card h3 { color: var(--primary-color); margin: 0 0 5px 0; font-size: 22px; }
    .summary-card p { color: var(--text-muted); margin: 0; font-size: 13px; text-transform: uppercase; }

    .salary-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .salary-table th { text-align: left; padding: 12px; background: #f8f9fa; color: var(--text-muted); font-size: 13px; font-weight: 600; }
    .salary-table td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }
    .salary-table tr:last-child td { border-bottom: none; }

    /* Responsive */
    @media (max-width: 900px) {
        .profile-layout { grid-template-columns: 1fr; }
        .profile-sidebar { order: -1; } /* Sidebar on top on mobile */
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <a href="{{ url_for('employee_list') }}" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Employees
        </a>
        
        {% if session.role in ['ADMIN', 'HR'] %}
        <button class="btn btn-primary" onclick="alert('Redirect to Edit Employee Page')">
            <i class="fas fa-edit"></i> Edit Profile
        </button>
        {% endif %}
    </div>

    <div class="profile-layout">
        
        <div class="profile-sidebar">
            
            <div class="profile-card">
                <div class="profile-avatar">
                    {{ user.first_name[0] }}{{ user.last_name[0] }}
                </div>
                <div class="profile-name">{{ user.first_name }} {{ user.last_name }}</div>
                <div class="profile-role">{{ user.job_title }}</div>
                
                <div style="margin-top: 25px; text-align: left;">
                    <div class="sidebar-info-row">
                        <span class="info-label">Employee ID</span>
                        <span class="info-val">#{{ user.id }}</span>
                    </div>
                    <div class="sidebar-info-row">
                        <span class="info-label">Department</span>
                        <span class="info-val">{{ user.department }}</span>
                    </div>
                    <div class="sidebar-info-row">
                        <span class="info-label">Location</span>
                        <span class="info-val">{{ user.work_location or 'Head Office' }}</span>
                    </div>
                    <div class="sidebar-info-row">
                        <span class="info-label">Status</span>
                        <span class="info-val" style="color: #28a745;">Active</span>
                    </div>
                </div>
            </div>

            <div class="profile-card" style="text-align: left; padding: 20px;">
                <h4 style="font-size: 14px; text-transform: uppercase; color: #999; margin-bottom: 15px;">Contact Details</h4>
                
                <div style="margin-bottom: 15px;">
                    <label class="info-label" style="font-size: 12px; display: block;">Work Email</label>
                    <div style="font-weight: 500; color: var(--primary-color);">{{ user.email }}</div>
                </div>
                
                <div>
                    <label class="info-label" style="font-size: 12px; display: block;">Phone Number</label>
                    <div style="font-weight: 500;">{{ user.phone or 'Not Provided' }}</div>
                </div>
            </div>

        </div>

        <div class="profile-content">
            
            <div class="profile-tabs">
                <button class="tab-btn active" onclick="openTab(event, 'general')">General Info</button>
                <button class="tab-btn" onclick="openTab(event, 'job')">Job Details</button>
                
                {% if session.role in ['ADMIN', 'HR'] or session.user_id == user.id %}
                <button class="tab-btn" onclick="openTab(event, 'salary')">Salary & Finance</button>
                {% endif %}
            </div>

            <div id="general" class="tab-content-area active">
                <h3 class="section-title">Personal Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>First Name</label>
                        <div class="read-only-field">{{ user.first_name }}</div>
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <div class="read-only-field">{{ user.last_name }}</div>
                    </div>
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <div class="read-only-field">{{ user.date_of_birth if user.date_of_birth else '--' }}</div>
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <div class="read-only-field">{{ user.gender or 'Not Specified' }}</div>
                    </div>
                    <div class="form-group">
                        <label>Marital Status</label>
                        <div class="read-only-field">{{ user.marital_status or 'Single' }}</div>
                    </div>
                    <div class="form-group">
                        <label>Nationality</label>
                        <div class="read-only-field">{{ user.nationality or 'Indian' }}</div>
                    </div>
                </div>

                <h3 class="section-title">Address Details</h3>
                <div class="form-group">
                    <label>Current Address</label>
                    <div class="read-only-field">{{ user.address or 'No address provided' }}</div>
                </div>
            </div>

            <div id="job" class="tab-content-area">
                <h3 class="section-title">Employment Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date of Joining</label>
                        <div class="read-only-field">{{ user.date_of_joining }}</div>
                    </div>
                    <div class="form-group">
                        <label>Job Title</label>
                        <div class="read-only-field">{{ user.job_title }}</div>
                    </div>
                    <div class="form-group">
                        <label>Department</label>
                        <div class="read-only-field">{{ user.department }}</div>
                    </div>
                    <div class="form-group">
                        <label>Manager</label>
                        <div class="read-only-field">{{ user.manager_name or 'None' }}</div>
                    </div>
                    <div class="form-group">
                        <label>Work Shift</label>
                        <div class="read-only-field">{{ user.shift_time or 'General (9AM - 6PM)' }}</div>
                    </div>
                    <div class="form-group">
                        <label>Employment Type</label>
                        <div class="read-only-field">{{ user.employment_type or 'Full Time' }}</div>
                    </div>
                </div>
            </div>

            <div id="salary" class="tab-content-area">
                
                <div class="salary-summary-cards">
                    <div class="summary-card">
                        <h3>₹{{ "{:,.0f}".format(user.basic_salary) if user.basic_salary else '0' }}</h3>
                        <p>Basic Salary</p>
                    </div>
                    <div class="summary-card">
                        <h3>{{ user.wage_type or 'Monthly' }}</h3>
                        <p>Wage Type</p>
                    </div>
                </div>

                <h3 class="section-title">Bank Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Bank Name</label>
                        <div class="read-only-field">{{ user.bank_name or '--' }}</div>
                    </div>
                    <div class="form-group">
                        <label>Account Number</label>
                        <div class="read-only-field">{{ user.bank_account_no or '--' }}</div>
                    </div>
                    <div class="form-group">
                        <label>IFSC Code</label>
                        <div class="read-only-field">{{ user.ifsc_code or '--' }}</div>
                    </div>
                    <div class="form-group">
                        <label>PAN Number</label>
                        <div class="read-only-field">{{ user.pan_number or '--' }}</div>
                    </div>
                </div>

                <h3 class="section-title" style="margin-top: 20px;">Salary Structure</h3>
                <table class="salary-table">
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th style="text-align: right;">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Basic Pay</td>
                            <td style="text-align: right;">₹{{ "{:,.2f}".format(user.basic_salary) if user.basic_salary else '0.00' }}</td>
                        </tr>
                        <tr>
                            <td>HRA (House Rent Allowance)</td>
                            <td style="text-align: right;">₹{{ "{:,.2f}".format(user.hra) if user.hra else '0.00' }}</td>
                        </tr>
                        <tr>
                            <td>Other Allowances</td>
                            <td style="text-align: right;">₹{{ "{:,.2f}".format(user.other_allowance) if user.other_allowance else '0.00' }}</td>
                        </tr>
                        <tr style="background-color: #f1f3f5;">
                            <td><strong>Total Gross Salary</strong></td>
                            <td style="text-align: right;"><strong>₹{{ "{:,.2f}".format((user.basic_salary or 0) + (user.hra or 0) + (user.other_allowance or 0)) }}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function openTab(evt, tabName) {
        // 1. Hide all tab contents
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content-area");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // 2. Remove "active" class from all tab buttons
        tablinks = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // 3. Show the current tab and add "active" class to the button
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>
{% endblock %}